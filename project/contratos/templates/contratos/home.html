<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedidos</title>
{%load static %}
<link rel="stylesheet" href="{% static 'contratos/nav.css' %}">
<script src="https://unpkg.com/lucide@latest"></script>
</head>
<body data-section="contratos">
<div class="container">
  <!-- side bar -->
  <aside class="sidebar">
    <div class="logo">
       <img src="{% static 'contratos/img/logobranca.png' %}"><!-- imagem do logo '0' -->
    </div>

    <nav class="menu">
      <a href="{% url 'home' %}" class="menu-item" data-section="home">
          <i data-lucide="home"></i>
        <span>Principal</span>
      </a>
       <a href="{% url 'contratos' %}"class="menu-item active" data-section="contratos">
         <i data-lucide="file-text"></i>
        <span>Contratos</span>
      </a>
      <a href="{% url 'lista_clientes' %}" class="menu-item" data-section="clientes">
        <i data-lucide="users"></i>
        <span>Clientes</span>
      </a>
      <a href="{% url 'listar_itens' %}" class="menu-item" data-section="itens">
        <i data-lucide="package"></i>
        <span>Itens</span>
      </a>
      <a href="{% url 'painel_financeiro' %}" class="menu-item" data-section="financas">
        <i data-lucide="wallet"></i>
        <span>Financeiro</span>
      </a>
    </nav>


<div class="logout">
      <a href="{% url 'pagina_login' %}">
          <i data-lucide="log-out"></i>
          <span>Sair</span>
        </a>
      </div>
    </aside> 
    <main class="main">
      <div class="headerPedido">
        <h1 class="idPedido">
          {% if cliente %}
            Contrato · {{ cliente.nome }}
          {% else %}
            Contratos
          {% endif %}
        </h1>
      </div>

      <div class="containerBranco">
        <!-- Barra de Progresso -->
        <div class="progressBar">
          <div class="progressStep completed">
            <i data-lucide="check-circle"></i>
            <span class="stepLabel">Orçamento</span>
            <span class="stepDate">18/10</span>
          </div>
          <div class="progressLine completed"></div>
          <div class="progressStep completed">
            <i data-lucide="check-circle"></i>
            <span class="stepLabel">Data Limite</span>
            <span class="stepDate">22/10</span>
          </div>
          <div class="progressLine"></div>
          <div class="progressStep">
            <i data-lucide="circle"></i>
            <span class="stepLabel">Concluído</span>
            <span class="stepDate"></span>
          </div>
        </div>
        <button class="prosseguir">Prosseguir</button>
        <div class="linhaCinza"></div>

        <!-- Informações Gerais -->
        <div class="infoPedido">
          <h3>Informações gerais</h3>
          <div class="infoGrid">
          <div class="infoItem">
            <p class="infoLabel">Cliente:</p>
            <p class="infoValue">
              {% if cliente %}
                {{ cliente.nome }}
              {% else %}
                Selecione um cliente na tela anterior
              {% endif %}
            </p>
          </div>
          <div class="infoItem">
            <p class="infoLabel">Telefone:</p>
            <p class="infoValue">
              {% if cliente %}
                {{ cliente.telefone|default:"—" }}
              {% else %}
                —
              {% endif %}
            </p>
          </div>
          <div class="infoItem">
            <p class="infoLabel">E-mail:</p>
            <p class="infoValue">
              {% if cliente %}
                {{ cliente.email|default:"—" }}
              {% else %}
                —
              {% endif %}
            </p>
          </div>
        </div>
      </div>
      <!-- Pedidos do Cliente -->
      <div class="pedidoCliente">
        <h3 class="textopd">Festa do cliente</h3>
        <div class="linhaCinza"></div>
        {% if cliente %}
          <div class="pedidoItem">
            <span class="pedidoNome">Nome:</span>
            <span class="pedidoPreco">{{ cliente.nome|default:"—" }}</span>
          </div>
          <div class="linhaCinza"></div>
          <div class="pedidoItem">
            <span class="pedidoNome">E-mail:</span>
            <span class="pedidoPreco">{{ cliente.email|default:"—" }}</span>
          </div>
          <div class="linhaCinza"></div>
          <div class="pedidoItem">
            <span class="pedidoNome">Telefone:</span>
            <span class="pedidoPreco">{{ cliente.telefone|default:"—" }}</span>
          </div>
          <div class="linhaCinza"></div>
          <div class="pedidoItem">
            <span class="pedidoNome">Tema:</span>
            <span class="pedidoPreco">
              {% if cliente.tema and cliente.tema.strip %}
                {{ cliente.tema }}
              {% elif festa and festa.nome_festa %}
                {{ festa.nome_festa }}
              {% else %}
                —
              {% endif %}
            </span>
          </div>
          <div class="linhaCinza"></div>
          <div class="pedidoItem">
            <span class="pedidoNome">Data:</span>
            <span class="pedidoPreco">
              {% if cliente.data_evento %}
                {{ cliente.data_evento|date:"d/m/Y" }}
              {% elif festa and festa.data %}
                {{ festa.data|date:"d/m/Y" }}
              {% else %}
                —
              {% endif %}
            </span>
          </div>
          <div class="linhaCinza"></div>
          <div class="pedidoItem">
            <span class="pedidoNome">Local:</span>
            <span class="pedidoPreco">
              {% if cliente.local %}
                {{ cliente.local }}
              {% elif festa and festa.local %}
                {{ festa.local }}
              {% else %}
                —
              {% endif %}
            </span>
          </div>
          <div class="linhaCinza"></div>
          <div class="valorTotal">
            <span>Valor:</span>
            <span class="totalPreco">
              {% if cliente.valor_total %}
                R$ {{ cliente.valor_total|floatformat:2 }}
              {% elif festa and festa.preco %}
                R$ {{ festa.preco|floatformat:2 }}
              {% else %}
                —
              {% endif %}
            </span>
          </div>
        {% else %}
          <p class="sem-festa">
            Nenhum cliente selecionado.
          </p>
        {% endif %}
      </div>
  </main>




<script>
  document.addEventListener('DOMContentLoaded', function () {
    if (window.lucide && typeof window.lucide.createIcons === 'function') {
      window.lucide.createIcons();
    }
  });
</script>


<script>
  (function () {
    var button = document.querySelector('.prosseguir');
    var steps = Array.prototype.slice.call(document.querySelectorAll('.progressBar .progressStep'));
    var lines = Array.prototype.slice.call(document.querySelectorAll('.progressBar .progressLine'));
    var currentIndex = 0;
    var clickCount = 0;


    if (!button || steps.length === 0) return;


     // Cores originais
    var originalColors = {
      icon: '#999',
      label: '#3f1947',
      date: '#666',
      line: '#e5e5e5'
    };


     // Garante que a primeira linha comece cinza
    if (lines[0]) {
      lines[0].style.backgroundColor = originalColors.line;
      lines[0].classList.remove('completed');
    }


    function resetAllSteps() {
      steps.forEach(function(step) {
        step.style.color = '';
        var svg = step.querySelector('svg');
        if (svg) {
          svg.style.stroke = originalColors.icon;
        }
        var label = step.querySelector('.stepLabel');
        if (label) {
          label.style.color = originalColors.label;
        }
        var date = step.querySelector('.stepDate');
        if (date) {
        date.style.color = originalColors.date;
      }
      });
      
      lines.forEach(function(line) {
        line.style.backgroundColor = originalColors.line;
        line.classList.remove('completed');
      });
    }


    function makeStepGreen(step) {
      step.style.color = '#16a34a';
      var svg = step.querySelector('svg');
      if (svg) {
        svg.style.stroke = '#16a34a';
      }
      var label = step.querySelector('.stepLabel');
      if (label) {
      label.style.color = '#16a34a';
      }
      var date = step.querySelector('.stepDate');
      if (date) {
        date.style.color = '#16a34a';
      }
    }


    function makeLineGreen(line) {
    line.style.backgroundColor = '#16a34a';
    }


    button.addEventListener('click', function () {
      clickCount += 1;


       // No 4º clique, reseta tudo e reinicia
      if (clickCount === 4) {
        resetAllSteps();
        currentIndex = 0;
        clickCount = 0;
      return;
      }


       // Clique 1: primeiro step fica verde
       // Clique 2: primeira linha + segundo step ficam verdes
       // Clique 3: segunda linha + terceiro step ficam verdes
      if (currentIndex < steps.length) {
         // Pinta o step atual
        makeStepGreen(steps[currentIndex]);
        
         // Se não é o primeiro step, pinta a linha anterior
        if (currentIndex > 0 && lines[currentIndex - 1]) {
          makeLineGreen(lines[currentIndex - 1]);
        }
        
        currentIndex += 1;
      }
    });
  })();
</script>
<script src="{% static 'forum/nav.js' %}"></script>

</body>
</html>
