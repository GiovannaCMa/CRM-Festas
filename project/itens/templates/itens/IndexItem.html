<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Página de Itens</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'itens/styleItem.css' %}">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  </head>

  <body data-section="itens">

    <div class="container">

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="logo">
          <img src="{% static 'itens/img/logobranca.png' %}">
        </div>

        <nav class="menu">
          <a href="{% url 'home' %}" class="menu-item" data-section="home">
            <i data-lucide="home"></i>
            <span>Principal</span>
          </a>

          <a href="{% url 'contratos' %}" class="menu-item" data-section="contratos">
            <i data-lucide="file-text"></i>
            <span>Contratos</span>
          </a>

          <a href="{% url 'lista_clientes' %}" class="menu-item" data-section="clientes">
            <i data-lucide="users"></i>
            <span>Clientes</span>
          </a>

          <a href="{% url 'listar_itens' %}" class="menu-item active" data-section="itens">
            <i data-lucide="package"></i>
            <span>Itens</span>
          </a>

          <a href="{% url 'painel_financeiro' %}" class="menu-item" data-section="financas">
            <i data-lucide="wallet"></i>
            <span>Financeiro</span>
          </a>
        </nav>

        <div class="logout">
          <a href="{% url 'pagina_login' %}">
            <i data-lucide="log-out"></i>
            <span>Sair</span>
          </a>
        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <main class="main-content">
        <div class="content-header">
          <h1>Itens</h1>
        </div>

        <form method="get" action="{% url 'listar_itens' %}" class="search-form">

          <div class="unified-container">
            
            <div class="textos-de-cima">
              <div class="Pesquisar">Pesquisar</div>
            </div>

            <div class="search-row">
              <div class="search-field">
                <input 
                  type="text" 
                  id="pesquisar" 
                  placeholder="Pesquisar o cód, nome, categoria..." 
                  value="{{ request.GET.pesquisar }}"
                  name="pesquisar"
                >
                <i class="search-icon" data-lucide="search"></i>
              </div>
            </div>

            <div class="search-row">
              <div class="action-button1">
                <button class="btn-primary" type="submit">Aplicar</button>
              </div>
              <div class="action-button2">
                <button class="btn-secondary" type="reset">Limpar</button>
              </div>
            </div>

            <div class="dropdown-fields">
              <div class="dropdown-field-word1">Ordenar por :</div>
              <div class="dropdown-field1">
                <button class="order-button" type="button">Nenhum selecionado</button>
                <i data-lucide="chevron-down"></i>

                <div class="order-menu" aria-hidden="true">
                  <label><input type="radio" name="order" value="name"><span>Nome</span></label>
                  <label><input type="radio" name="order" value="date"><span>Data</span></label>
                  <label><input type="radio" name="order" value="color"><span>Cor</span></label>
                </div>
              </div>
            </div>

            <div class="linha-horizontal-cinza"></div>

            <!-- LISTAGEM DOS ITENS -->
            <div class="itens-container" id="itensContainer">

              <!-- Cabeçalho -->
              <div class="item-header">
                  <div>ID</div>
                  <div>Material</div>
                  <div>Quantidade</div>
                  <div>Ações</div>
              </div>

              <!-- Loop dos itens -->
              {% for material in materiais %}
              <div class="item-info">

                  <div class="col">{{ material.id }}</div>
                  <div class="col">{{ material.item }}</div>
                  <div class="col">{{ material.quant }}</div>

                  <div class="col acoes">

                      <!-- EXCLUIR -->
                      <button type="button" class="btn-delete"
                          onclick="abrirModal('{{ material.id }}', '{{ material.item }}')">
                          <i data-lucide="trash-2"></i>
                      </button>

                      <!-- EDITAR -->
                      <button type="button" class="btn-edit"
                          onclick="abrirEditar('{{ material.id }}')">
                          <i data-lucide="pencil"></i>
                      </button>

                  </div>

              </div>
              {% endfor %}

            </div>

          </div>
        </form>

      </main>

    </div>

    <script>
      lucide.createIcons();
    </script>


    <!-- MODAL EXCLUIR -->
    <div id="modalExcluir" class="modal-overlay" style="display: none;">
      <div class="modal-box">
        <h2>Confirmar Exclusão</h2>
        <p id="modalTexto">Tem certeza que deseja excluir?</p>

        <div class="modal-actions">
          <button class="btn-cancelar" onclick="fecharModal()">Cancelar</button>
          <div id="formExcluir" data-url=""></div>
          <button class="btn-confirmar" onclick="confirmarExclusao()">Excluir</button>
        </div>
      </div>
    </div>



        <!-- MENU DE OPÇÕES DE EDIÇÃO -->
    <div id="menuEditar" class="modal-overlay" style="display:none;">
      <div class="modal-box">
          <h2>O que deseja editar?</h2>

          <div class="modal-actions" style="flex-direction:column; gap:10px;">

              <button class="btn-edit-option" onclick="editarCampo('item')">
                  Nome
              </button>

              <button class="btn-edit-option" onclick="editarCampo('quant')">
                  Quantidade
              </button>

              <button class="btn-cancelar" onclick="fecharMenuEditar()">
                  Cancelar
              </button>
          </div>
      </div>
    </div>


    <!-- MODAL DE EDIÇÃO (ÚNICO, CORRIGIDO) -->
    <div id="modalEditar" class="modal-overlay" style="display: none;">
      <div class="modal-box">
          <h2 id="tituloEdicao">Editar</h2>

          <form id="formEdicao" method="POST">
              {% csrf_token %}

              <input type="hidden" name="id" id="editarId">
              <input type="hidden" name="campo" id="editarCampo">

              <label id="labelCampo">Nova Quantidade:</label>
              <input type="text" name="valor" id="editarValor" class="input-editar">

              <div class="modal-actions" style="margin-top:20px; gap:10px;">
                  <button type="button" class="btn-cancelar" onclick="fecharModalEditar()">Cancelar</button>
                  <button type="submit" class="btn-confirmar">Salvar</button>
              </div>
          </form>
      </div>
    </div>

    <script src="{% static 'itens/script.js' %}"></script>

  </body>
</html>
